<h1>Admin Panel</h1>
<div>
    <form method="post">
        <button type="submit" class="btn btn-primary" asp-controller="UserRoles" asp-action="AddRole">Role Manager</button>
        <button type="submit" class="btn btn-primary" asp-controller="UserRoles" asp-action="AddUser">Create User</button>
    </form>
    <table class="table table-striped" id="tableu">
        <thead>
            <tr>
                <th>User Name</th>
                <th>Email</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Roles</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <form method="post">
        <button type="submit" class="btn btn-primary" asp-controller="UserRoles" asp-action="AddGenre">Genre Manager</button>
        <button type="submit" class="btn btn-primary" asp-controller="UserRoles" asp-action="AddStatus">Status Manager</button>
        <button type="submit" class="btn btn-primary" asp-controller="UserRoles" asp-action="AddBook">Create Book</button>
    </form>
    <table class="table table-striped" id="tableb">
        <thead>
            <tr>
                <th>Picture</th>
                <th>Book Name</th>
                <th>Autor</th>
                <th>Year</th>
                <th>Articl</th>
                <th>Genre</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>
<script src='@Url.Content("~/lib/jquery/dist/jquery.js")' type="text/javascript"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"></script>
<script>

    InitPage();
    function InitPage() {
        $.ajax({
            type: "Get",
            url: '@Url.Action("ReturnUser", "UserRoles")',
            success: function (data) {
                console.log(data);
                $('#tableu').DataTable({
                    data: data,
                    columns: [
                        { data: 'user.userName' },
                        { data: 'user.email' },
                        { data: 'user.firstName' },
                        { data: 'user.lastName' },
                        { data: 'role' },
                        { data: 'user.id'}
                    ],
                    columnDefs: [{
                        targets: 5,
                        orderable: false,
                        className: 'button',
                        render: function (data, type, row, meta) {
                            return ` <a class="btn btn-primary" href="/UserRoles/EditUser?userId=${data}">Edit</a>
                            <a class="btn btn-primary" href="/UserRoles/EditP?userId=${data}">Edit Pass</a>
                            <a class="btn btn-primary" href="/UserRoles/Manage?userId=${data}">Manage Roles</a>
                            <a class="btn btn-primary" href="@Url.Action("DeleteUser","UserRoles")?userId=${data}">Delete</a>`;
                        }
                    }],
                    order: [[1, 'asc']]
                })
            }
        });
        $.ajax({
            type: "Get",
            url: '@Url.Action("ReturnBook", "UserRoles")',
            success: function (data) {
                console.log({data});
                $('#tableb').DataTable({
                    data: data,
                    columns: [
                        { data: 'bookPicture' },
                        { data: 'name' },
                        { data: 'author' },
                        { data: 'year' },
                        { data: 'articl' },
                        { data: 'bookGenres' },
                        { data: 'status.statusName' },
                        { data: 'id' },
                    ],
                    columnDefs: [{
                        targets: 7,
                        orderable: false,
                        className: 'button',
                        render: function (data, type, row, meta) {
                            return ` <a class="btn btn-primary" href="/UserRoles/EditBook?bookId=${data}">Edit</a>
                            <a class="btn btn-primary" href="/UserRoles/ManageGenre?bookId=${data}">Manage Genre</a>
                            <a class="btn btn-primary" href="/UserRoles/ManageStatus?bookId=${data}">Manage Status</a>
                            <a class="btn btn-primary" href="@Url.Action("DeleteBook", "UserRoles")?bookId=${data}">Delete</a>`;
                        }
                    },
                        {
                            targets: 0,
                            orderable: false,
                            render: function (data, type, row, meta) {
                                return `<img style="width:40px;height:40px; object-fit:cover; border-radius:30px" src="${data}"/>`;
                            }
                        },
                        {
                            targets: 5,
                            orderable: false,
                            render: function (data, type, row, meta) {
                                console.log(data)
                                return `${data.map(item=>item.genre.genreName)}`;
                            }
                        }],
                    order: [[1, 'asc']]
                })
            }
        });
    }
</script>